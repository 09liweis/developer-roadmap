import{j as e}from"./jsx-runtime.BPj4-Rfu.js";import{r as l}from"./index.SSXOyoI7.js";import{D as A}from"./index.es.B1RiJbf6.js";/* empty css                       */import{u as D}from"./use-outside-click.BWzraQDw.js";import{u as q}from"./use-keydown.DCIacX8c.js";import{a as k}from"./http.BfNEAXh_.js";import{t as N}from"./resource-progress.CaCjaD4j.js";import{g as F,d as P}from"./browser.z0e42_13.js";import{u as H}from"./use-auth.Bku_Ubkw.js";import{E as z}from"./ErrorIcon.Cf6fFoCT.js";import{S as G}from"./Spinner.B1Yt5gOc.js";import{X as J}from"./x.wVDa2hJ0.js";function _(d){const{isLoading:n,error:t}=d;return e.jsx("div",{className:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{className:"relative mx-auto flex h-full w-full items-center justify-center",children:e.jsx("div",{className:"popup-body relative rounded-lg bg-white p-5 shadow",children:e.jsxs("div",{className:"flex items-center",children:[n&&e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-6 w-6",isDualRing:!1}),e.jsx("span",{className:"ml-3 text-lg font-semibold",children:"Loading user progress..."})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx(z,{additionalClasses:"h-6 w-6 text-red-500"}),e.jsx("span",{className:"ml-3 text-lg font-semibold",children:t})]})]})})})})}function B(d){const{isLoading:n,progressResponse:t}=d,j=t?.user,i=t?.progress,r=i?.total||0,p=i?.done?.length||0,m=Math.round(p/r*100)||0,y=i?.learning?.length||0,x=i?.skipped?.length||0;return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-5 mt-0 min-h-[28px] text-left sm:text-center md:mt-4 md:h-[60px]",children:[e.jsxs("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[j?.name,"'s Progress"]}),e.jsx("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:"You can close this popup and start tracking your progress."})]}),e.jsxs("p",{className:"-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden",children:[e.jsxs("span",{className:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:m}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:p})," of ",e.jsx("span",{children:r})," done"]})]}),e.jsxs("p",{className:`-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex ${n?"striped-loader":""}`,children:[e.jsxs("span",{className:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:m}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:p})," completed"]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:y})," in progress"]}),x>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:x})," skipped"]})]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:r})," Total"]})]})]})}function ne(d){const{resourceId:n,resourceType:t,userId:j,onClose:i}=d,{s:r=j}=F();if(!r)return null;const p=l.useRef(null),m=l.useRef(null),y=H(),[x,L]=l.useState(!!r),[R,U]=l.useState(null),[I,M]=l.useState(),[b,v]=l.useState(!0),[E,S]=l.useState("");let h="https://roadmap.sh";t==="roadmap"?h+=`/${n}.json`:h+=`/best-practices/${n}.json`;async function C(s,a,c){const{error:f,response:g}=await k(`https://api.roadmap.sh/v1-get-user-progress/${s}?resourceType=${a}&resourceId=${c}`);if(f||!g)throw f||new Error("Something went wrong. Please try again!");return g}async function $(s){const{error:a,response:c}=await k(s);if(a||!c)throw a||new Error("Something went wrong. Please try again!");return await A(c,{fontURL:"/fonts/balsamiq.woff2"})}function w(){P("s"),S(""),L(!1),i?i():window.location.reload()}return q("Escape",()=>{w()}),D(m,()=>{w()}),l.useEffect(()=>{!h||!n||!t||!r||(v(!0),Promise.all([$(h),C(r,t,n)]).then(([s,a])=>{if(!a||!s)return;const{progress:c}=a,{done:f,learning:g,skipped:T}=c||{done:[],learning:[],skipped:[]};f?.forEach(o=>{N(o,s).forEach(u=>{u.classList.add("done")})}),g?.forEach(o=>{N(o,s).forEach(u=>{u.classList.add("learning")})}),T?.forEach(o=>{N(o,s).forEach(u=>{u.classList.add("skipped")})}),s.querySelectorAll(".clickable-group").forEach(o=>{o.classList.remove("clickable-group")}),s.querySelectorAll("[data-group-id]").forEach(o=>{o.removeAttribute("data-group-id")}),U(s),M(a)}).catch(s=>{S(s?.message||"Something went wrong. Please try again!")}).finally(()=>{v(!1)}))},[r]),y?.id===r?(P("s"),null):x?b||E?e.jsx(_,{isLoading:b,error:E}):e.jsx("div",{id:"user-progress-modal",className:"fixed left-0 right-0 top-0 z-50 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{className:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e.jsxs("div",{ref:m,className:"popup-body relative rounded-lg bg-white pt-[1px] shadow",children:[e.jsx(B,{isLoading:b,progressResponse:I}),e.jsx("div",{ref:p,className:"px-4 pb-2",dangerouslySetInnerHTML:{__html:R?.outerHTML||""}}),e.jsxs("button",{type:"button",className:"absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-gray-100 bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden",onClick:w,children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]})})}):null}export{_ as P,B as U,ne as a};
