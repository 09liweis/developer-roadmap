import{j as e}from"./jsx-runtime.BPj4-Rfu.js";import{r as g}from"./index.SSXOyoI7.js";import{h as B,a as R}from"./http.B-35sOsF.js";import{g as I}from"./date.CKNRH15o.js";import{u as S}from"./use-toast.CK2mpur1.js";import{ProgressShareButton as D}from"./ProgressShareButton.Dagy6S9G.js";import{g as F}from"./jwt.M546E6_Y.js";import{p as x}from"./page.C3ddTGlS.js";import{R as E}from"./RoadmapIcon.DUeTpdPA.js";import"./toast.BGQI3kl5.js";import"./index.CEvxOxeV.js";import"./use-auth.BNYEoi-W.js";import"./use-copy-text.i66JXdki.js";import"./CheckIcon.Dy4QWWBd.js";import"./classname.B_pfcvI6.js";import"./bundle-mjs.CpAuaXBl.js";function y(n){const{text:i,count:o}=n;return e.jsxs("div",{className:"relative flex flex-1 flex-row-reverse sm:flex-col px-0 sm:px-4 py-2 sm:py-4 text-center sm:pt-10 items-center gap-2 sm:gap-0 justify-end",children:[e.jsx("h2",{className:"text-base sm:text-5xl font-bold",children:o}),e.jsx("p",{className:"mt-0 sm:mt-2 text-sm text-gray-400",children:i})]})}function P(n){const{done:i,learning:o,streak:m}=n;return e.jsx("div",{className:"mx-0 -mt-5 sm:-mx-10 md:-mt-10",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-0 sm:gap-2 divide-y sm:divide-y-0 divide-x-0 sm:divide-x border-b",children:[e.jsx(y,{text:"Topics Completed",count:`${i?.total||0}`}),e.jsx(y,{text:"Currently Learning",count:`${o?.total||0}`}),e.jsx(y,{text:"Visit Streak",count:`${m?.count||0}d`})]})})}function w(n){const{showClearButton:i=!0,isCustomResource:o}=n,m=S(),[l,d]=g.useState(!1),[u,c]=g.useState(!1),p=F()?.id,{updatedAt:t,resourceType:s,resourceId:r,title:a,totalCount:h,learningCount:v,doneCount:f,skippedCount:j,onCleared:C}=n;async function b(){d(!0);const{error:N,response:$}=await B("https://api.roadmap.sh/v1-clear-resource-progress",{resourceId:r,resourceType:s});if(N||!$){m.error("Error clearing progress. Please try again."),console.error(N),d(!1);return}localStorage.removeItem(`${s}-${r}-${p}-favorite`),localStorage.removeItem(`${s}-${r}-${p}-progress`),d(!1),c(!1),C&&C()}let A=s==="roadmap"?`/${r}`:`/best-practices/${r}`;o&&(A=`/r?id=${r}`);const k=f+j,T=Math.round(k/h*100);return e.jsxs("div",{children:[e.jsxs("a",{href:A,className:"group relative flex cursor-pointer items-center rounded-t-md border p-3 text-gray-600 hover:border-gray-300 hover:text-black",children:[e.jsx("span",{className:"absolute left-0 top-0 block h-full cursor-pointer rounded-tl-md bg-black/5 group-hover:bg-black/10",style:{width:`${T}%`}}),e.jsx("span",{className:"relative  flex-1 cursor-pointer truncate",children:a}),e.jsx("span",{className:"ml-1 cursor-pointer text-sm text-gray-400",children:I(t)})]}),e.jsxs("div",{className:"sm:space-between flex flex-row items-start rounded-b-md border border-t-0 px-2 py-2 text-xs text-gray-500",children:[e.jsxs("span",{className:"hidden flex-1 gap-1 sm:flex",children:[f>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[f," done"]})," •"]}),v>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[v," in progress"]})," •"]}),j>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[j," skipped"]})," •"]}),e.jsxs("span",{children:[h," total"]})]}),e.jsxs("div",{className:"flex w-full items-center justify-between gap-2 sm:w-auto sm:justify-start",children:[e.jsx(D,{resourceType:s,resourceId:r,isCustomResource:o,className:"text-xs font-normal",shareIconClassName:"w-2.5 h-2.5 stroke-2",checkIconClassName:"w-2.5 h-2.5"}),e.jsx("span",{className:"hidden sm:block",children:"•"}),i&&e.jsxs(e.Fragment,{children:[!u&&e.jsxs("button",{className:"text-red-500 hover:text-red-800",onClick:()=>c(!0),disabled:l,children:[!l&&e.jsxs(e.Fragment,{children:["Clear Progress ",e.jsx("span",{children:"×"})]}),l&&"Processing..."]}),u&&e.jsxs("span",{children:["Are you sure?"," ",e.jsx("button",{onClick:b,className:"ml-1 mr-1 text-red-500 underline hover:text-red-800",children:"Yes"})," ",e.jsx("button",{onClick:()=>c(!1),className:"text-red-500 underline hover:text-red-800",children:"No"})]})]})]})]})]})}function L(){return e.jsx("div",{className:"rounded-md",children:e.jsxs("div",{className:"flex flex-col items-center p-7 text-center",children:[e.jsx(E,{className:"mb-2 w-[60px] h-[60px] sm:h-[120px] sm:w-[120px] opacity-10"}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold",children:"No Progress"}),e.jsxs("p",{className:"my-1 sm:my-2 max-w-[400px] text-gray-500 text-sm sm:text-base",children:["Progress will appear here as you start tracking your"," ",e.jsx("a",{href:"/roadmaps",className:"mt-4 text-blue-500 hover:underline",children:"Roadmaps"})," ","or"," ",e.jsx("a",{href:"/best-practices",className:"mt-4 text-blue-500 hover:underline",children:"Best Practices"})," ","progress."]})]})})}function ee(){const[n,i]=g.useState(),[o,m]=g.useState(!0);async function l(){const{error:t,response:s}=await R("https://api.roadmap.sh/v1-get-user-stats");if(!s||t){console.error("Error loading activity"),console.error(t);return}i(s)}g.useEffect(()=>{l().finally(()=>{x.set(""),m(!1)})},[]);const d=n?.learning.roadmaps||[],u=n?.learning.bestPractices||[];if(o)return null;const c=d.sort((t,s)=>{const r=new Date(t.updatedAt);return new Date(s.updatedAt).getTime()-r.getTime()}).filter(t=>t.learning>0||t.done>0),p=u.sort((t,s)=>{const r=new Date(t.updatedAt);return new Date(s.updatedAt).getTime()-r.getTime()}).filter(t=>t.learning>0||t.done>0);return e.jsxs(e.Fragment,{children:[e.jsx(P,{done:n?.done||{today:0,total:0},learning:n?.learning||{today:0,total:0},streak:n?.streak||{count:0}}),e.jsxs("div",{className:"mx-0 px-0 py-5 md:-mx-10 md:px-8 md:py-8",children:[c.length===0&&p.length===0&&e.jsx(L,{}),(c.length>0||p.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mb-3 text-xs uppercase text-gray-400",children:"Continue Following"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[d.sort((t,s)=>{const r=new Date(t.updatedAt);return new Date(s.updatedAt).getTime()-r.getTime()}).filter(t=>t.learning>0||t.done>0).map(t=>{const s=t.learning||0,r=t.done||0,a=t.total||0,h=t.skipped||0;return e.jsx(w,{isCustomResource:t.isCustomResource,doneCount:r>a?a:r,learningCount:s>a?a:s,totalCount:a,skippedCount:h,resourceId:t.id,resourceType:"roadmap",updatedAt:t.updatedAt,title:t.title,onCleared:()=>{x.set("Updating activity"),l().finally(()=>{x.set("")})}},t.id)}),u.sort((t,s)=>{const r=new Date(t.updatedAt);return new Date(s.updatedAt).getTime()-r.getTime()}).filter(t=>t.learning>0||t.done>0).map(t=>e.jsx(w,{isCustomResource:t.isCustomResource,doneCount:t.done||0,totalCount:t.total||0,learningCount:t.learning||0,resourceId:t.id,skippedCount:t.skipped||0,resourceType:"best-practice",title:t.title,updatedAt:t.updatedAt,onCleared:()=>{x.set("Updating activity"),l().finally(()=>{x.set("")})}},t.id))]})]})]})]})}export{ee as ActivityPage};
