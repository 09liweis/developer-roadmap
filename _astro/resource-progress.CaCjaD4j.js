import{g as $,a as q,T as b}from"./jwt.DjKu0S3o.js";import{h as x,a as C}from"./http.BfNEAXh_.js";import{r as R,t as _}from"./roadmap.SDi3zlny.js";async function O(e){const{topicId:t,resourceType:o,resourceId:s}=e,{done:n=[]}=await m(o,s)||{};return n?.includes(t)}async function H(e){const{topicId:t,resourceType:o,resourceId:s}=e,n=await m(o,s);return n?.done?.includes(t)?"done":n?.learning?.includes(t)?"learning":n?.skipped?.includes(t)?"skipped":"pending"}async function B(e,t){const{topicId:o,resourceType:s,resourceId:n}=e,{response:r,error:l}=await x("https://api.roadmap.sh/v1-update-resource-progress",{topicId:o,resourceType:s,resourceId:n,progress:t});if(l||!r?.done||!r?.learning)throw new Error(l?.message||"Something went wrong");return f(s,n,r.done,r.learning,r.skipped),r}async function m(e,t){if(!q.get(b))return{done:[],learning:[],skipped:[]};const o=$()?.id,s=`${e}-${t}-${o}-progress`,n=`${e}-${t}-favorite`,r=localStorage.getItem(n),l=JSON.parse(r||"0")===1,a=localStorage.getItem(s),c=JSON.parse(a||"null"),u=c?.timestamp,g=new Date().getTime()-parseInt(u||"0",10)>15*60*1e3;return!c||g?P(e,t):(f(e,t,c?.done||[],c?.learning||[],c?.skipped||[]),window.dispatchEvent(new CustomEvent("mark-favorite",{detail:{resourceType:e,resourceId:t,isFavorite:l}})),c)}async function P(e,t){const{response:o,error:s}=await C("https://api.roadmap.sh/v1-get-user-resource-progress",{resourceType:e,resourceId:t});return s||!o?(console.error(s),{done:[],learning:[],skipped:[]}):(f(e,t,o?.done||[],o?.learning||[],o?.skipped||[]),window.dispatchEvent(new CustomEvent("mark-favorite",{detail:{resourceType:e,resourceId:t,isFavorite:o.isFavorite}})),o)}function f(e,t,o,s,n){R.set({done:o,learning:s,skipped:n});const r=$()?.id;localStorage.setItem(`${e}-${t}-${r}-progress`,JSON.stringify({done:o,learning:s,skipped:n,timestamp:new Date().getTime()}))}function T(e,t=document){const o=[];return t.querySelectorAll(`[data-group-id$="-${e}"]`).forEach(s=>{const n=s?.dataset?.groupId||"";new RegExp(`^\\d+-${e}$`).test(n)&&o.push(s)}),d([`[data-group-id="${e}"]`,`[data-group-id="check:${e}"]`,`[data-node-id="${e}"]`,`[data-id="${e}"]`,`[data-checklist-checkbox][data-checklist-id="${e}"]`,`[data-checklist-label][data-checklist-id="${e}"]`],t).forEach(s=>{o.push(s)}),o}function h(e,t){const o=t==="learning",s=t==="skipped",n=t==="done",r=t==="removed";T(e).forEach(a=>{n?(a.classList.add("done"),a.classList.remove("learning","skipped")):o?(a.classList.add("learning"),a.classList.remove("done","skipped")):s?(a.classList.add("skipped"),a.classList.remove("done","learning")):r?(a.classList.add("removed"),a.classList.remove("done","learning","skipped")):a.classList.remove("done","skipped","learning","removed")})}function G(){const e=d([".clickable-group",'[data-type="topic"]','[data-type="subtopic"]',".react-flow__node-topic",".react-flow__node-subtopic"]);for(const t of e)t.classList.remove("done","skipped","learning","removed")}async function I(e,t){const{done:o=[],learning:s=[],skipped:n=[]}=await m(e,t)||{};o.forEach(r=>{h(r,"done")}),s.forEach(r=>{h(r,"learning")}),n.forEach(r=>{h(r,"skipped")}),M()}function d(e,t=document){const o=[];return e.forEach(s=>{t.querySelectorAll(s).forEach(n=>{o.push(n)})}),o}function M(){const e=document.querySelectorAll("[data-progress-nums-container]"),t=document.querySelectorAll("[data-progress-nums]");if(e.length===0||t.length===0)return;const o=d([".clickable-group",'[data-type="topic"]','[data-type="subtopic"]',".react-flow__node-topic",".react-flow__node-subtopic"]).length,s=document.querySelectorAll('[data-group-id^="ext_link:"]').length,n=document.querySelectorAll('[data-group-id^="json:"]').length,r=document.querySelectorAll('[data-group-id^="check:"]').length,l=document.querySelectorAll('[data-group-id^="check:"].done').length,a=document.querySelectorAll('[data-group-id^="check:"].learning').length,c=document.querySelectorAll('[data-group-id^="check:"].skipped').length,u=document.querySelectorAll(".clickable-group.removed").length,p=o-s-n-r-u;_.set(p);const g=d(['.clickable-group.done:not([data-group-id^="ext_link:"])',"[data-node-id].done","[data-id].done"]).length-l,L=d([".clickable-group.learning","[data-node-id].learning","[data-id].learning"]).length-a,k=d([".clickable-group.skipped","[data-node-id].skipped","[data-id].skipped"]).length-c,E=document.querySelectorAll("[data-progress-done]");E.length>0&&E.forEach(i=>i.innerHTML=`${g}`);const v=document.querySelectorAll("[data-progress-learning]");v.length>0&&v.forEach(i=>i.innerHTML=`${L}`);const S=document.querySelectorAll("[data-progress-skipped]");S.length>0&&S.forEach(i=>i.innerHTML=`${k}`);const y=document.querySelectorAll("[data-progress-total]");y.length>0&&y.forEach(i=>i.innerHTML=`${p}`);const A=Math.round((g+k)/p*100)||0,w=document.querySelectorAll("[data-progress-percentage]");w.length>0&&w.forEach(i=>i.innerHTML=`${A}`),e.forEach(i=>i.classList.remove("striped-loader")),t.forEach(i=>{i.classList.remove("opacity-0")})}export{h as a,M as b,G as c,H as g,O as i,I as r,T as t,B as u};
